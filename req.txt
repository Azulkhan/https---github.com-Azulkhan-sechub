local http = require("socket.http")
local ltn12 = require("ltn12")

-- Функция для URL-кодирования строки
function urlencode(str)
    if not str then
        return ""
    end
    
    str = string.gsub(str, "([^%w%-_%.%~])",
        function(c)
            return string.format("%%%02X", string.byte(c))
        end)
    
    return str
end

-- Функция для выполнения POST-запроса
function httppost2(url, headers, data)
    local response_body = {}
    local res, code, response_headers, status = http.request{
        url = url,
        method = "POST",
        headers = headers,
        source = ltn12.source.string(data),
        sink = ltn12.sink.table(response_body)
    }
    return res, code, response_headers, status, table.concat(response_body)
end

-- Данные для POST-запроса
local url = "http://your-url-here.com/endpoint"
local post_data = "code=" .. urlencode("8vsdsd==") .. "&code2=" .. urlencode("b8dfdfdf=")
local headers = {
    ["Content-Type"] = "application/x-www-form-urlencoded",
    ["Content-Length"] = tostring(#post_data)
}

-- Выполнение POST-запроса
local res, code, response_headers, status, response_body = httppost2(url, headers, post_data)

-- Вывод результата
if res then
    print("Response code: " .. code)
    print("Response body: " .. response_body)
else
    print("HTTP request failed: " .. code)
end
